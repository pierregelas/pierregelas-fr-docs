---
doc_id: import_tous_les_articles
titre: "Import ‚ÄúTous les articles‚Äù ‚Äî R√©f√©rence compl√®te (Obsidian ‚áÑ CSV)"
type_doc: spec
version: v2
version_precedente: v1
date_maj: 2025-10-08
etat: courant
notes: "v2 = simplification du flux et s√©paration contenus / portfolio"
---


## Introduction

Conception d'une **infrastructure de donn√©es unifi√©e** dans une vault Obsidian, pens√©e comme **le c≈ìur d'un √©cosyst√®me de production et de publication** :

- **Base de donn√©es personnelle** (projets, productions, vid√©os).
- **Passerelle WP ‚Üí Obsidian** via export CSV (_WP Import Export Lite_) + **CSV/JSON Importer** et un **template Handlebars** + **helpers.js**.
- **Obsidian ‚Üí WP** via exports depuis des vues `.base`/Dataview (hors p√©rim√®tre v2 ‚Äúsite‚Äù).

> **Nom de note** (Field to use as Note name) : `${wp_titre}` ou `@{ return (this.wp_titre ?? '').trim(); }`.  
> Les caract√®res non s√ªrs (`? \ / * " < > | :`) peuvent √™tre remplac√©s automatiquement dans le **filename** ; le YAML conserve le titre exact.

---

### üß≠ Contexte et objectifs du document

Ce document centralise :

- la **correspondance compl√®te** CSV (WordPress) ‚Üí **YAML** (Obsidian) avec r√®gles, types et transformations ;
- le **template Handlebars** final v2 ;
- le **helpers.js** (helpers utilis√©s : `slugify_wp`, `startsWith`) ;
- les **param√®tres cl√©s** du plugin CSV/JSON Importer.  
    Objectif : une **interop√©rabilit√© claire et stable** WP ‚Üí Obsidian, avec toutes les m√©tadonn√©es WP en YAML et un corps de note r√©-importable.

---

### üîú √âtapes suivantes du projet

1. **Cr√©er un mini plugin local Obsidian (non publi√©)**  
   Automatiser la cr√©ation/mise √† jour de notes selon les r√®gles (ex. marquage `wp_correction`, `wp_update`, normalisations, relances d‚Äôimport cibl√©es).

2. **Ajouter un helper `includes`**  
   Permettre des tests de sous-cha√Æne (ex. ¬´ si `wp_categories` **contient** `Projets`‚Ä¶ ¬ª) pour diversifier les comportements conditionnels dans le template.

3. **Automatiser les liens crois√©s**  
   Pr√©-remplir `lien_prods` et d‚Äôautres relations internes √† partir de motifs (cat√©gories, tags, patrons de titres), avec d√©duplication et v√©rification d‚Äôexistence des notes cibles.

4. **(Option) G√©n√©rer les notes de taxonomie**  
   Cr√©er/mettre √† jour automatiquement des notes pour chaque `wp_tag` / `wp_category` (depuis exports WP ‚Äútags‚Äù et ‚Äúcategories‚Äù contenant label/slug/id/count) afin d‚Äôalimenter des tables `.base` par taxonomie.

---

## 1) üß© Mappage CSV ‚Üí YAML (avec r√®gles)

Les champs **orient√©s CV** sont **supprim√©s** en v2 (colonne ‚ÄúV2‚Äù).  
‚ÄúNouveau‚Äù = nouveau nom de champ YAML ; ‚ÄúObsol√®te‚Äù = √† retirer du template.


| Champ YAML (v2)      | Source CSV                  | V2                                        | Type               | R√®gle / Transformation                                             |
| -------------------- | --------------------------- | ----------------------------------------- | ------------------ | ------------------------------------------------------------------ |
| `cover`              | `wp_img_url`                | ‚Äî                                         | texte              | Prendre **la 1 ≥·µâ URL** (s√©parateur `                               |
| `descr_obs`          | ‚Äî                           | ‚Äî                                         | texte              | Champ libre Obsidian.                                              |
| `lien_projet`        | `wp_categories`             | ‚Äî                                         | **liste**          | **D√©coupe sur `>`**, garde libell√© non-slugifi√©, rend `[[Nom]]`.   |
| `post_date`          | `wp_date`                   | **Nouveau** (remplace `prod_diff`)        | texte ISO          | `YYYY-MM-DDTHH:MM:SS` (remplacer l‚Äôespace par `T`).                |
| `titre`              | `wp_titre`                  | ‚Äî                                         | texte              | Copie directe.                                                     |
| `tags`               | `wp_tags` + `wp_categories` | ‚Äî                                         | **liste**          | Fusion : `wp_tags` (`,`), `wp_categories` (`>`), puis **slugify**. |
| `type_note`          | ‚Äî                           | ‚Äî                                         | texte / liste      | Libre (si utile c√¥t√© site).                                        |
| `wp_categories`      | `wp_categories`             | ‚Äî                                         | **liste**          | `>` ‚Üí liste + **slugify**.                                         |
| `wp_id`              | `wp_id`                     | ‚Äî                                         | nombre             | Copie directe.                                                     |
| `wp_type`            | `wp_type`                   | ‚Äî                                         | texte              | Copie directe.                                                     |
| `wp_status`          | `wp_status`                 | ‚Äî                                         | texte              | Copie directe.                                                     |
| `wp_perma`           | `wp_perma`                  | ‚Äî                                         | texte              | Permalink.                                                         |
| `wp_date`            | `wp_date`                   | ‚Äî                                         | texte ISO          | Date brute WP en ISO.                                              |
| `post_modified`      | `wp_date_modified`          | **Nouveau** (remplace `wp_date_modified`) | texte ISO          | Date de modification ISO.                                          |
| `wp_extrait`         | `wp_extrait`                | ‚Äî                                         | texte              | Copie directe.                                                     |
| `wp_carnet_link`     | `wp_carnet_link`            | ‚Äî                                         | texte              | Copie directe.                                                     |
| `wp_carnet_on`       | `wp_carnet_on`              | ‚Äî                                         | bool√©en            | **true** si non vide, **false** sinon.                             |
| `wp_a_descr_gen`     | `wp_a_descr_gen`            | ‚Äî                                         | texte              | ACF.                                                               |
| `wp_a_titre_gen`     | `wp_a_titre_gen`            | ‚Äî                                         | texte              | ACF.                                                               |
| `wp_a_stitre_gen`    | `wp_a_stitre_gen`           | ‚Äî                                         | texte              | ACF.                                                               |
| `wp_a_videolink_gen` | `wp_a_videolink_gen`        | ‚Äî                                         | texte              | ACF.                                                               |
| `wp_img_url`         | `wp_img_url`                | ‚Äî                                         | **liste**          | S√©paration `                                                       |
| `wp_img_alt`         | `wp_img_alt`                | ‚Äî                                         | **liste**          | S√©paration `                                                       |
| `wp_img_caption`     | `wp_img_caption`            | ‚Äî                                         | **liste**          | S√©paration `                                                       |
| `wp_img_descr`       | `wp_img_descr`              | ‚Äî                                         | **liste**          | S√©paration `                                                       |
| `wp_img_filename`    | `wp_img_filename`           | ‚Äî                                         | **liste**          | S√©paration `                                                       |
| `wp_img_id`          | `wp_img_id`                 | ‚Äî                                         | **liste**          | S√©paration `                                                       |
| `wp_img_titre`       | `wp_img_titre`              | ‚Äî                                         | **liste**          | S√©paration `                                                       |
| `wp_correction`      | ‚Äî                           | ‚Äî                                         | bool√©en (checkbox) | **Par d√©faut `false`**.                                            |
| `wp_update`          | ‚Äî                           | ‚Äî                                         | bool√©en            | **Par d√©faut `false`**.                                            |


---

## 2) üß™ Template Handlebars (CSV/JSON Importer)

> √Ä coller tel quel dans ton fichier **Template Handlebars g√©n√©ral.md**.

```hbs
---
# ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CHAMPS G√âN√âRAUX ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
cover: "{{#each (strsplit wp_img_url "||")}}{{#if @first}}{{replacereg this "^\s+|\s+$" ""}}{{/if}}{{/each}}"
descr_obs:

# Liens internes de projet depuis les cat√©gories (libell√©s non-slugifi√©s)
lien_projet:
{{#each (strsplit wp_categories ">")}}
  {{#if (replacereg this "^\s*$" "")}}- "[[{{replacereg this "^\s+|\s+$" ""}}]]"{{/if}}
{{/each}}

# Date de publication normalis√©e (remplace l'ancien prod_diff)
post_date: "{{replacereg wp_date " " "T"}}"

# ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî TITRE + TAGS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
titre: "{{wp_titre}}"

# Tags = fusion wp_tags + wp_categories (slugifi√©s)
tags:
{{!-- D'abord les tags WP (s√©par√©s par des virgules) --}}
{{#each (strsplit wp_tags ",")}}
  {{#if (replacereg this "^\s*$" "")}}- {{slugify_wp (replacereg this "^\s+|\s+$" "")}}{{/if}}
{{/each}}

{{!-- Puis les cat√©gories WP (chemin s√©par√© par ">") --}}
{{#each (strsplit wp_categories ">")}}
  {{#if (replacereg this "^\s*$" "")}}- {{slugify_wp (replacereg this "^\s+|\s+$" "")}}{{/if}}
{{/each}}

# Type de note libre (si utile c√¥t√© site)
type_note:

# ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CAT√âGORIES WP ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
wp_categories:
{{#each (strsplit wp_categories ">")}}
  {{#if (replacereg this "^\s*$" "")}}- {{slugify_wp (replacereg this "^\s+|\s+$" "")}}{{/if}}
{{/each}}

# ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî M√âTA WORDPRESS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
wp_id: {{wp_id}}
wp_type: "{{wp_type}}"
wp_status: "{{wp_status}}"
wp_perma: "{{wp_perma}}"

# Dates brutes WP en ISO
wp_date: "{{replacereg wp_date " " "T"}}"

# Date de modification (nouveau champ)
post_modified: "{{replacereg wp_date_modified " " "T"}}"

wp_extrait: "{{wp_extrait}}"

# ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CARNET LI√â ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
wp_carnet_link: "{{wp_carnet_link}}"
wp_carnet_on: {{#if (replacereg wp_carnet_on "^\s*$" "")}}true{{else}}false{{/if}}

# ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ACF ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
wp_a_descr_gen: "{{wp_a_descr_gen}}"
wp_a_titre_gen: "{{wp_a_titre_gen}}"
wp_a_stitre_gen: "{{wp_a_stitre_gen}}"
wp_a_videolink_gen: "{{wp_a_videolink_gen}}"

# ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî IMAGES WP (s√©parateur "||") ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
wp_img_url:
{{#each (strsplit wp_img_url "||")}}
  {{#if (replacereg this "^\s*$" "")}}- {{replacereg this "^\s+|\s+$" ""}}{{/if}}
{{/each}}

wp_img_alt:
{{#each (strsplit wp_img_alt "||")}}
  {{#if (replacereg this "^\s*$" "")}}- {{replacereg this "^\s+|\s+$" ""}}{{/if}}
{{/each}}

wp_img_caption:
{{#each (strsplit wp_img_caption "||")}}
  {{#if (replacereg this "^\s*$" "")}}- {{replacereg this "^\s+|\s+$" ""}}{{/if}}
{{/each}}

wp_img_descr:
{{#each (strsplit wp_img_descr "||")}}
  {{#if (replacereg this "^\s*$" "")}}- {{replacereg this "^\s+|\s+$" ""}}{{/if}}
{{/each}}

wp_img_filename:
{{#each (strsplit wp_img_filename "||")}}
  {{#if (replacereg this "^\s*$" "")}}- {{replacereg this "^\s+|\s+$" ""}}{{/if}}
{{/each}}

wp_img_id:
{{#each (strsplit wp_img_id "||")}}
  {{#if (replacereg this "^\s*$" "")}}- "{{replacereg this "^\s+|\s+$" ""}}"{{/if}}
{{/each}}

wp_img_titre:
{{#each (strsplit wp_img_titre "||")}}
  {{#if (replacereg this "^\s*$" "")}}- {{replacereg this "^\s+|\s+$" ""}}{{/if}}
{{/each}}

# ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî WORKFLOW ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
wp_correction: false
wp_update: false
---

{{!-- Corps conditionnel ‚Äî Photo vs Vid√©o --}}
{{#if (startsWith wp_categories "Photo")}}

## Photos

{{#each (strsplit wp_img_url "||")}}
{{#if (replacereg this "^\s+|\s+$" "")}}![]({{replacereg this "^\s+|\s+$" ""}})

{{/if}}
{{/each}}

## Notes

![[{{wp_titre}}_notes]]

{{else}}
  {{#if (startsWith wp_categories "Vid√©o")}}

## Vignette

{{#each (strsplit wp_img_url "||")}}
{{#if (replacereg this "^\s+|\s+$" "")}}![]({{replacereg this "^\s+|\s+$" ""}})

{{/if}}
{{/each}}

## Vid√©o

![{{wp_titre}}]({{wp_a_videolink_gen}})

## Notes

![[{{wp_titre}}_notes]]

  {{/if}}
{{/if}}

```

---

## 3) üõ†Ô∏è helpers.js

```js
// helpers.js ‚Äî pour Obsidian CSV/JSON Importer
// Contient les helpers personnalis√©s utilis√©s dans le template Handlebars.

// -------------------------------------------------------------
// Helper 1 : slugify_wp ‚Äî normalise √† la mani√®re WordPress
// -------------------------------------------------------------
function hb_slugify_wp() {
  const orig = String(arguments[0] ?? '');
  let s = orig.toLowerCase();                             // minuscules
  s = s.normalize('NFD').replace(/[\u0300-\u036f]/g, ''); // supprime accents
  s = s.replace(/'/g, '');                                // supprime apostrophes
  s = s.replace(/\s*-\s*/g, '-');                        // " - " ‚Üí "-"
  s = s.replace(/\s+/g, '-');                             // espaces ‚Üí "-"
  s = s.replace(/[^a-z0-9-]/g, '');                       // garde a-z0-9-
  s = s.replace(/-+/g, '-').replace(/^-|-$/g, '');        // nettoie les doubles/trailing tirets
  return s;
}
handlebars.registerHelper('slugify_wp', hb_slugify_wp);

// -------------------------------------------------------------
// Helper 2 : startsWith ‚Äî test de pr√©fixe
// -------------------------------------------------------------
function startsWith() {
  const hay = String(arguments[0] ?? '');
  const needle = String(arguments[1] ?? '');
  return hay.startsWith(needle);
}
handlebars.registerHelper('startsWith', startsWith);
```

---

## Processus (rappel)

| Action | Requis | Commentaire |
|---|---|---|
| Exporter un CSV de WordPress | Plugin **WP Import Export Lite** (preset ¬´ Tous les articles ¬ª) | Voir description des presets d'export pour d√©tail des champs. |
| Ouvrir Obsidian | Obsidian | ‚Äî |
| Ouvrir **CSV/JSON Importer** | Plugin | ‚Äî |
| Choisir le CSV | Fichier export√© | ‚Äî |
| Choisir le **Template Handlebars** | Fichier `.md` | Aligner avec ce document. |
| Choisir le **helpers.js** | Fichier `.js` | Fournit `slugify_wp`, `startsWith`. |
| Lancer la cr√©ation | ‚Äî | ‚Äî |

---

## Logs

### üóìÔ∏è 2025-10-08 ‚Äî Corps conditionnel + helper
- **Corps conditionnel selon `wp_categories`** :
  - Si √ßa commence par **Photo** ‚Üí section **Photos** (galerie de toutes les `wp_img_url`).
  - Si √ßa commence par **Vid√©o** ‚Üí sections **Vignette** (galerie) + **Vid√©o** (lien YouTube), puis **Notes**.
- **Ajout du helper `startsWith`** dans `helpers.js` pour g√©rer ces conditions.

### üóìÔ∏è 2025-10-08 ‚Äî Lien projets & galerie
- **`lien_projet`** : aliment√© automatiquement depuis `wp_categories` en **liens internes** non‚Äëslugifi√©s `[[Nom]]`.
- **Photos** : remplacement de l‚Äôancienne section par une **galerie verticale** de toutes les images.

### üóìÔ∏è 2025-10-09 ‚Äî Qualit√© & suivi
- **`wp_correction`** (checkbox) ajout√© par d√©faut √† `false` pour marquer les notes √† corriger c√¥t√© WP.
- **Normalisations valid√©es** : tags fusionn√©s (tags+cat√©gories) slugifi√©s, `prod_diff` en ISO, `wp_img_id` en cha√Ænes, s√©parateurs corrects (tags=`,` / cat√©gories=`>` / images=`||`).

### üóìÔ∏è 2025-10-10 ‚Äî v2
- S√©paration des usages : vault **‚Äúsite‚Äù** (WP ‚áÑ Obsidian) vs **‚Äúportfolio/CV‚Äù** (pr√©sentation).
- **Suppression** des champs orient√©s CV du YAML/Template.
- **Ajouts/renommages** : `post_date` (ex-`prod_diff`), `post_modified` (ex-`wp_date_modified`).
- Conservation de la logique **Tags fusion** (tags+cat√©gories) et du **corps Photo/Vid√©o**.