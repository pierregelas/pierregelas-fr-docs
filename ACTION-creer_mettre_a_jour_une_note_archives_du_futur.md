---
doc_id: action_archives_du_futur
titre: ACTION - Cr√©er-Mettre √† jour une note Archives du futur
type_doc: action
version: v1
version_precedente: none
date_maj: 2025-10-15
etat: courant
notes: "v0.2: Processus 2 (modale Diff; cases d√©coch√©es si identiques; patch YAML in-place; renommage propos√©; modale d‚Äôinfo si 0 changement). v0.1: Processus 1 (cr√©ation depuis Journal photo; image _WP.webp‚Üí_BF.webp; YAML complet avec s√©parateurs; post_cat: [photo, archives-du-futur]; maj_wp: true)."
---




# ACTION : Cr√©er/Mettre √† jour une note _Archives du futur_
---

## 1. Explications

Aucune information n'est demand√©e √† l'utilisateur.

**La cr√©ation/Mise √† jour est bas√©e sur l'existence d'une note Journal.**
- Elle ne s'effectue que si elle est activ√©e sur une note contenant `journal-photo` dans `post_cat`.
	- Sinon arr√™t de l'action et `message d'alerte` : `Cette note n'est pas une note Journal Photo !`

Les informations sont toutes d√©riv√©es des informations d√©j√† pr√©sentes dans la note Journal photo correspondante. Nous l'appellerons `Note journal source` dans ce document.

Les notes Journal photo et Archives correspondantes partagent un identifiant unique qui est la date et heure de post_date. Ce sont les seules √† avoir cet id, et cela peut donc servir de v√©rification : 
Si la note contient en `lien_projet`: `Journal Photo`  et que sa `post_date:` `2024-01-26T16:28:00`, alors la note contenant `Archives du futur` en `lien_projet` et le m√™me `post_date`: `2024-01-26T16:28:00` est son √©quivalent, et vice-versa.

## 2. Processus

2 cas de figures peuvent se pr√©senter : 
- La note archives du futur, dont le lien wiki a √©t√© cr√©√© lors de la cr√©ation de la `Note journal source` n'existe pas encore dans la vault : `Processus 1 : Cr√©ation note Archives`
- La note archives du futur, dont le lien wiki a √©t√© cr√©√© lors de la cr√©ation de la `Note journal source` existe d√©j√† dans la vault : `Processus 2 : Mise √† jour note Archives`

## 3. Processus 1 : Cr√©ation note Archives

Le titre de la note est cr√©√© automatiquement.
La note se compose de deux parties :  
un bloc d‚Äôinformations (YAML) et un corps (contenu visible).

Au niveau du processus, si c'√©tait un humain qui faisait √ßa, il lui suffirait de :
- cliquer sur le lien wiki de `lien_archives` de la `note journal source`
- dans la note nouvellement cr√©√©e remplir le yaml comme suit :
### Nom du fichier .md

copie de `lien_archives` de `note journal source` 

### üßæ Bloc d‚Äôinformations FULL (YAML)

```
---
cover:                # auto : copie de img_filename

IMAGES: ______________________________________________________________________

img_alt:              # auto : copie de `post_titre_1`
img_descr:            # vide
img_filename:         # auto : d√©riv√© de `img_filename` de `note journal source`
img_id:               # vide
img_legende:          # auto : copie du titre de la note archives
img_titre:            # vide
img_url:              # vide

LIEN: ______________________________________________________________________

lien_archives:        # vide
lien_journal:         # auto : lien wiki de `note journal source`
lien_projet:          # pr√©-rempli
  - "[[Photo]]"
  - "[[Archives du futur]]"
lien_restes:          # auto : copie de `lien_restes` de `note journal source`

MAJ: ______________________________________________________________________

maj_wp: true         # pr√©-rempli: true

POST: ______________________________________________________________________

post_cat:             # pr√©-rempli - slug category
  - photo
  - archives-du-futur
post_date:         # auto : copie de `post-date` de `note journal source`
post_descr:        # vide
post_extrait:      # vide
post_id:           # vide
post_mod:          # vide
post_perma:        # vide
post_titre_1:      # auto : d√©riv√© du titre de la note archives
post_titre_2:      # auto : d√©riv√© du titre de la note archives
post_titre_full:   # auto : copie du titre de la note archives
post_vid_url:      # vide
tags:              # vide

WP: ______________________________________________________________________

wp_carnet_link:      # vide
wp_carnet_on:        # vide
wp_status:           # vide
---
```


#### Explications

##### img_filename:  # auto : d√©riv√© de `img_filename` de `note journal source`
- utilise `img_filename` de `note journal source`
- remplace `_WP` par `_BF`

> [!example] Exemple
> `img_filename` de `note journal source`: `2024-01-26_16_28_3109684_WP.webp`
> 
> `img_filename`: `2024-01-26_16_28_3109684_BF.webp`

##### post_titre_1:  # auto : d√©riv√© du titre de la note archives
- Utilise le titre de fichier de la note archives (relative √† `lien_archives` de `note source journal`)
- Prends tout ce qui est AVANT le mot Archives, (en enlevant le dernier espace, doit terminer par un point)

> [!example] Exemple
> `titre de fichier de la note archives` : `Lampadaire ? Toile d'araigneÃÅe ? Archives du dimanche 26 janvier 2024 ?`
> 
> `post_titre_1:` `Lampadaire ? Toile d'araigneÃÅe ?`

##### post_titre_2:  # auto : d√©riv√© du titre de la note archives
- Utilise le titre de fichier de la note archives (relative √† `lien_archives` de `note source journal`)
- Prends tout ce qui est APR√àS le mot Archives (inclus).

> [!example] Exemple
> `titre de fichier de la note archives` : `Lampadaire ? Toile d'araigneÃÅe ? Archives du dimanche 26 janvier 2024 ?`
> 
> `post_titre_2:` `Archives du dimanche 26 janvier 2024 ?`

#### üìÑ Corps de la note

```
## Photo

![[img_filename]]

## Notes

![[`titre de la note archives` + `_notes`]]

```


___

## 4. Exemple d‚Äôentr√©e et de r√©sultat Processus 1 

### Entr√©e de la note Journal photo

**Bloc YAML**

```yaml
---
cover: 2024-01-26_16_28_3109684_WP.webp

IMAGES: ______________________________________________________________________

img_alt: 
  - Lampadaire, toile d'araigneÃÅe.
img_descr:
img_filename: 
  - 2024-01-26_16_28_3109684_WP.webp
img_id:
img_legende:
  - Lampadaire, toile d'araigneÃÅe. Journal du dimanche 26 janvier 2024.
img_titre:  
img_url:

LIEN: ______________________________________________________________________

lien_archives: "[[Lampadaire ? Toile d'araigneÃÅe ? Archives du dimanche 26 janvier 2024 ?]]"
lien_journal:
lien_projet:
  - "[[Photo]]"
  - "[[Journal photo]]"
lien_restes: "[[Lampadaire ? Toile d'araigneÃÅe ? Restes du dimanche 26 janvier 2024 ?]]"

MAJ: ______________________________________________________________________

maj_wp: true

POST: ______________________________________________________________________

post_cat:
  - photo
  - journal-photo
post_date: 2024-01-26T16:28:00
post_descr:
post_extrait: 
post_id:
post_mod:
post_perma:
post_titre_1: Lampadaire, toile d'araigneÃÅe.
post_titre_2: Journal du dimanche 26 janvier 2024.
post_titre_full: Lampadaire, toile d'araigneÃÅe. Journal du dimanche 26 janvier 2024.
post_video_url:
tags:

WP: ______________________________________________________________________

wp_carnet_link:
wp_carnet_on:
wp_status:
---
```

**Corps de la note**

```
## Photo

![[2024-01-26_16_28_3109684_WP.webp]]

## Notes

![[Lampadaire, toile d'araigneÃÅe. Journal du dimanche 26 janvier 2024._notes]]

```

### R√©sultat obtenu

**Nom du fichier cr√©√©**

**Bloc YAML g√©n√©r√©**

```yaml
---
cover: 2024-01-26_16_28_3109684_BF.webp

IMAGES: ______________________________________________________________________

img_alt: 
  - Lampadaire ? toile d'araigneÃÅe ?
img_descr:
img_filename: 
  - 2024-01-26_16_28_3109684_BF.webp
img_id:
img_legende:
  - Lampadaire ? toile d'araigneÃÅe ? Archives du dimanche 26 janvier 2024 ?
img_titre:  
img_url:

LIEN: ______________________________________________________________________

lien_archives:
lien_journal: [[Lampadaire, toile d'araigneÃÅe. Journal du dimanche 26 janvier 2024.]]
lien_projet:
  - "[[Photo]]"
  - "[[Archives du futur]]"
lien_restes: "[[Lampadaire ? Toile d'araigneÃÅe ? Restes du dimanche 26 janvier 2024 ?]]"

MAJ: ______________________________________________________________________

maj_wp: true

POST: ______________________________________________________________________

post_cat:
  - photo
  - archives-du-futur
post_date: 2024-01-26T16:28:00
post_descr:
post_extrait: 
post_id:
post_mod:
post_perma:
post_titre_1: Lampadaire ? Toile d'araigneÃÅe ?
post_titre_2: Archives du dimanche 26 janvier 2024 ?
post_titre_full: Lampadaire ? Toile d'araigneÃÅe ? Archives du dimanche 26 janvier 2024 ?
post_video_url:
tags:

WP: ______________________________________________________________________

wp_carnet_link:
wp_carnet_on:
wp_status:
---
```

**Corps de la note**

```
## Photo

![[2024-01-26_16_28_3109684_BF.webp]]

## Notes

![[Lampadaire ? Toile d'araigneÃÅe ? Archives du dimanche 26 janvier 2024 ?_notes]]

```


## 5. Processus 2 : Mise √† jour de note archives

Pour l'instant, si la note Archives est d√©j√† cr√©√©, on arr√™te l'action avec le message : `La note Archives du futur est d√©j√† cr√©√© !`

L√† j'ai besoin de toi chatgpt pour d√©finir les choses.

L'objectif : mettre √† jour les informations essentielles et communes d'une note archives en fonction de la note source journal.
- Les informations communes : 
	- post_date: la note archives a TOUJOURS la m√™me post-date que la note journal source
	- tags: la note archives a TOUJOURS la m√™me liste yaml tags que la note journal source
Ce que je veux : 
- Si la note est d√©j√† cr√©√© il faut donc analyser le contenu des 2 notes (note journal source et note archives correspondante).
- Il faut donc afficher une fen√™tre modale qui va afficher la diff entre les deux fichiers, accompagn√© de boutons `mettre √† jour` ou `annuler`
- Les choses √† v√©rifier pour la diff, cas de figures : 
	- Le post_date de la note journal source a chang√© :
		- la copier sur archives
	- les tags de la note journal source ont chang√© :
		- remplacer exactement les tags dans la note archives
	- Le titre de la note source journal a chang√© (la d√©rivation du titre de la note source journal ne donne plus la m√™me chose que le titre de la note archives √† mettre √† jour)
		- v√©rfier/red√©river  les informations :
			- v√©rifier/recr√©er le lien_archives dans la note source journal : il doit √™tre d√©riv√© du titre selon la m√©thode d√©j√† impl√©ment√©e
			- √† partir de lien_projet v√©rifier/modifier toutes les d√©rivations dans la note archives.
Il ya peut-√™tre des choses que j'oublie, dis-moi ce que tu en penses. 
ce processus de mise √† jour doit √™tre robuste, l√©ger, et clair. 


### sp√©cification finale ‚Äì Processus 2 (Mise √† jour d‚Äôune note ‚ÄúArchives du futur‚Äù) r√©dig√©e par chatgpt

#### üéØ Objectif

Depuis une **note Journal photo** ouverte, si la note **Archives du futur** li√©e **existe d√©j√†**, proposer une **mise √† jour contr√¥l√©e** (via une modale de diff) de quelques champs **communs/invariants** et, **si et seulement si** le titre Journal a chang√©, **recalculer** les d√©rivations c√¥t√© Archives pour conserver la coh√©rence avec le Processus 1.

#### ‚úÖ Pr√©conditions (hard stop si KO)

- La note courante est une **note Journal photo** ‚Üí `post_cat` contient `journal-photo`.
    
- Le champ `lien_archives` de la note Journal **pointe vers une note existante** (titre = texte du lien sans `[[ ]]`).
    

#### üß≠ S√©lection des deux notes (source/target)

- **Source** = note Journal (active).
    
- **Target (Archives)** = d‚Äôabord par `lien_archives` (texte sans `[[ ]]`), sinon **fallback** par recherche d‚Äôune note avec `post_cat` contenant `archives-du-futur` **et** `post_date` identique √† la source.
    

#### üß© Champs concern√©s par P2 (seulement)

##### Bloc A ‚Äî **Toujours propos√©s √† synchroniser**

- `post_date` (Archives ‚Üê Journal).
    
- `tags` (Archives ‚Üê Journal, **remplacement total**).
    

##### Bloc B ‚Äî **Propos√©s si le titre Journal a chang√©**

_(i.e. si le `lien_archives` recalcul√© √† partir du nouveau `post_titre_full` Journal diff√®re du texte actuel)_

- **Titres Archives** (re-d√©riv√©s depuis le **nouveau** `lien_archives` c√¥t√© Journal, m√™mes r√®gles que P1)
    
    - `post_titre_1` = partie **avant** ‚ÄúArchives‚Äù **sans ajouter de point** si d√©j√† termin√© par `?`/`!`.
        
    - `post_titre_2` = partie **depuis** ‚ÄúArchives‚Äù (inclu), ex. `Archives du dimanche 26 janvier 2024 ?`.
        
    - `post_titre_full` = **identique** au **texte du nouveau lien**.
        
- **Image & cover**
    
    - `img_filename` = image Journal avec `_WP.webp` ‚Üí `_BF.webp`.
        
    - `cover` = copie de `img_filename`.
        
    - `img_alt` = **`post_titre_1` des Archives**.
        
    - `img_legende` = **`post_titre_full` des Archives**.
        
    - `img_descr`, `img_id`, `img_titre`, `img_url` restent **vides**.
        
- **Liens**
    
    - `lien_journal` = `[[post_titre_full du Journal]]`.
        
    - `lien_restes` = copie depuis la note Journal.
        
    - `lien_archives` = **vide** (on est dans Archives).
        
    - `lien_projet` = `[[Photo]]`, `[[Archives du futur]]`.
        

#### ü™ü Modale de diff (UX)

- **En-t√™te**: ‚ÄúMettre √† jour la note ‚ÄòArchives du futur‚Äô li√©e √† cette note Journal ?‚Äù
    
- **Section A ‚Äî Champs communs** (checkbox coch√©es par d√©faut)
    
    - `post_date` (Source ‚Üí Target, montrer ancienne/nouvelle valeur).
        
    - `tags` (liste ‚Üí liste, montrer diff simple).
        
- **Section B ‚Äî Titre modifi√©** _(rendue visible uniquement si le `lien_archives` recalcul√© ‚â† actuel)_
    
    - Titres √† jour (`post_titre_1/2/full`).
        
    - Image/cover/alt/l√©gende.
        
    - Liens (`lien_journal`, `lien_restes`, `lien_archives` vide, `lien_projet`).
        
- **Pied**:
    
    - Bouton **Mettre √† jour** (applique **uniquement** les cases coch√©es).
        
    - Bouton **Annuler** (aucun changement).
        

#### üîÉ Ordre de mise √† jour (atomique, minimal)

1. **Recalcule √©ventuel** du `lien_archives` c√¥t√© Journal (en m√©moire, sans modifier la note Journal dans P2).
    
2. **R√©solution de la note Archives** (via lien, fallback par `post_date`).
    
3. **Constitution de la diff** (Bloc A toujours, Bloc B seulement si titre chang√©).
    
4. **Si ‚ÄúMettre √† jour‚Äù**:
    
    - Appliquer d‚Äôabord **Bloc A** (`post_date`, `tags`).
        
    - Puis **Bloc B** si coch√© (titres, image, liens).
        
    - **Rename de fichier** si le **nouveau `post_titre_full`** ‚â† **nom de fichier actuel**: renommer le `.md` des Archives au **texte du nouveau lien** (Obsidian met √† jour les backlinks automatiquement).
        
5. Ne **rien toucher** aux autres champs (`post_descr`, `post_extrait`, `post_id`, `post_mod`, `post_perma`, `wp_*`, corps, etc.).
    

#### üß™ Crit√®res d‚Äôacceptation

- Si `post_cat` (source) ‚â† `journal-photo` ‚Üí message clair, **aucune modification**.
    
- Si la note Archives est introuvable ‚Üí message clair, **aucune modification**.
    
- Si aucune diff√©rence n‚Äôest d√©tect√©e dans les blocs coch√©s ‚Üí message ‚ÄúRien √† mettre √† jour‚Äù.
    
- Apr√®s mise √† jour:
    
    - `post_date` et `tags` d‚ÄôArchives = **copie exacte** de Journal.
        
    - Si Bloc B appliqu√©: `post_titre_*`, `img_*`, `cover`, `lien_*` d‚ÄôArchives = **coh√©rents Processus 1**.
        
    - Si renommage: nom de fichier d‚ÄôArchives = **nouveau `post_titre_full`**, liens internes OK.
        

#### üßØ Cas limites & garde-fous

- Si plusieurs notes Archives partagent le **m√™me `post_date`** (cas pathologique): afficher un **s√©lecteur** dans la modale pour choisir la cible.
    
- Si l‚Äôimage Journal ne suit plus la norme `_WP.webp`, la conversion `_BF` est **skipp√©e** et signal√©e (non bloquant).
    
- Toute erreur I/O ‚Üí message + **aucun changement** partiel (appliquer les mises √† jour de mani√®re group√©e).

## 6. DEV : services √† utiliser
*notes : les noms des fichiers .ts de services sont √† d√©finir.*

**post_titre_1:  # auto : d√©riv√© du titre de la note archives**
*Ce services peut √™tre aussi utilis√© dans le futur pour l'action **`Action Restes`**, lemot Reste servant de d√©limiteur. √† voir si √ßa peut √™tre mutualis√© entre ces 2 actions.*

- Utilise le titre de fichier de la note archives (relative √† `lien_archives` de `note source journal`)
- Prends tout ce qui est AVANT le mot Archives, (en enlevant le dernier espace, doit terminer par un point)


## 7. Notes
notes divers par moi-m√™me au cours des versions

## 8. Logs
inscrire ici les logs de changement de l'**`Action Archives`**.

### üóìÔ∏è 2025-10-15 ‚Äî Impl√©mentation Archives du futur (Processus 1)
- Pr√©condition : la note source doit √™tre un Journal photo (`post_cat` contient `journal-photo`) ; sinon, message d‚Äôerreur.
- Si la note Archives existe d√©j√† (via `lien_archives`), message et arr√™t.
- Nom de fichier = texte du `lien_archives` (sans `[[ ]]`).
- Titres : `post_titre_1` = partie avant ¬´ Archives ¬ª (ne rajoute pas de point si finie par `?`/`!`) ; `post_titre_2` = depuis ¬´ Archives ‚Ä¶ ? ¬ª ; `post_titre_full` = texte complet du lien.
- Images : `img_filename` d√©riv√© depuis Journal en rempla√ßant `_WP` ‚Üí `_BF` ; `img_alt` = `post_titre_1` des Archives ; `img_legende` = `post_titre_full`.
- Liens : `lien_journal` = `[[post_titre_full du Journal]]` ; `lien_restes` copi√© ; `lien_archives` vide ; `lien_projet` = `[[Photo]]`, `[[Archives du futur]]`.
- POST : `post_date` copi√© du Journal ; `post_cat` = `photo`, `archives-du-futur` ; `maj_wp: true`.
- Corps : section **Photo** (image `_BF.webp`) et section **Notes** (`[[post_titre_full_notes]]`).

### üóìÔ∏è 2025-10-15 ‚Äî Processus 2 (mise √† jour Archives du futur)
- Pr√©conditions: source = Journal photo; cible r√©solue via lien_archives ou fallback par post_date.
- Diff (A): post_date, tags; cases coch√©es seulement si diff√©rents.
- Diff (B): affich√©e si le titre Journal a chang√© (apr√®s recalc); titres (1/2/full), image (WP‚ÜíBF) + cover, img_alt = titre_1 Archives, img_legende = titre_full, lien_journal, lien_restes; cases coch√©es seulement si diff√©rents.
- Rename: propos√© si post_titre_full Archives change (nom de fichier = nouveau titre).
- Z√©ro diff√©rence: modale d‚Äôinformation ¬´ La note ‚ÄúArchives du futur‚Äù est parfaitement √† jour ! ¬ª.

### üóìÔ∏è 2025-10-15 ‚Äî Processus 2 (am√©liorations)
- Diff (A): `post_date`, `tags` ‚Äî cases coch√©es seulement si diff√©rent.
- Diff (B): affich√©e si le titre Journal a chang√© (apr√®s recalcul du Journal si besoin); titres (1/2/full), image `_WP‚Üí_BF` + `cover`, `img_alt`, `img_legende`, `lien_journal`, `lien_restes`; cases coch√©es seulement si diff√©rent.
- Renommage: propos√© si `post_titre_full` change (nom du fichier = nouveau titre).
- Z√©ro diff√©rence: modale d‚Äôinformation ¬´ La note ‚ÄúArchives du futur‚Äù est parfaitement √† jour ! ¬ª.
- Bon usage: si `post_titre_1` a √©t√© modifi√© dans le Journal, lancer d‚Äôabord ¬´ Journal ‚Üí Recalculer titres depuis post_titre_1 ¬ª.
